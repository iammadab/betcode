<%- include ("meta2.ejs") %>
<title>Add Tipster</title>
</head>
<body>

<div id="app">
	
	<%- include ("header_admin.ejs") %>

	<div class="main">

		<div class="container">

			<div class="post">
				
				<form>


					<div id="success" style="display: none" class="alert alert-success" role="alert">
  						Tip posted successfully
					</div>

					<div id="error" style="display: none" class="alert alert-danger" role="alert">
  						Tip posted unsuccessfully, please try again later 

					</div>

					<div class="divider mt-0 pt-0">
						<span></span>
						<span>Add Tipster Below</span>
						<span></span>
					</div>

					<div class="form-group">
						<input class="form-control" type="text" id="name" placeholder="Tipster Name" />
					</div>

					<div class="form-group">
						<div class="custom-file">
							<input type="file" id="image" class="custom-file-input" accept='image/*'>
      						<label class="custom-file-label">Tipster Display Picture</label>
						</div>
					</div>

					<div class="form-group">
						<button type="submit" class="btn btn-success">Add</button>
					</div>

				</form>

			</div>

		</div>
	
	</div>

</div>

</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<script type="text/javascript">
			const submit = document.querySelector("button")

			submit.addEventListener("click", (event) => {
				event.preventDefault()

				const name = document.querySelector("#name")
				const image = document.querySelector("#image")
				
				const files = image.files
				const formData = new FormData()
				formData.append("file", files[0])

				fetch("/api/upload", {
					method: "POST",
					body: formData
				})
				.then(res => res.json())
				.then(data => {
					const url = data.link
					return fetch("/api/tipster", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({
							name: name.value,
							image: url
						})
					})
				})
				.then(res => res.json())
				.then(() => {
					name.value = ""
					image.value = ""
				}) 


			})

			// Add the following code if you want the name of the file appear on select
		$(".custom-file-input").on("change", function() {
			var fileName = $(this).val().split("\\").pop();
  			$(this).siblings(".custom-file-label").addClass("selected").html(fileName);
		});
		</script>
